{"ast":null,"code":"import _regeneratorRuntime from\"C:/Users/luren/Documents/GitHub/netflix-clone-diy/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"C:/Users/luren/Documents/GitHub/netflix-clone-diy/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"C:/Users/luren/Documents/GitHub/netflix-clone-diy/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useEffect,useState}from\"react\";import{useSelector}from\"react-redux\";import{selectUser}from\"../features/userSlice\";import db from\"../firebase\";import\"./PlanScreen.css\";// stripe\nimport{loadStripe}from\"@stripe/stripe-js\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function PlansScreen(){var _useState=useState([]),_useState2=_slicedToArray(_useState,2),products=_useState2[0],setProducts=_useState2[1];var user=useSelector(selectUser);var _useState3=useState(null),_useState4=_slicedToArray(_useState3,2),subscription=_useState4[0],setSubscription=_useState4[1];useEffect(function(){db.collection(\"customers\").doc(user.uid).collection(\"subscriptions\").get().then(function(querySnapshot){querySnapshot.forEach(/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(subscription){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:setSubscription({role:subscription.data().role,current_period_end:subscription.data().current_period_end.seconds,current_period_start:subscription.data().current_period_start.seconds});case 1:case\"end\":return _context.stop();}}},_callee);}));return function(_x){return _ref.apply(this,arguments);};}());});},[user.uid]);useEffect(function(){db.collection(\"products\").where(\"active\",\"==\",true).get().then(function(querySnapshot){var products={};querySnapshot.forEach(/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(productDoc){var priceSnap;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:products[productDoc.id]=productDoc.data();_context2.next=3;return productDoc.ref.collection(\"prices\").get();case 3:priceSnap=_context2.sent;// so we take the prices from our database and forEach them onto\n// our new products array to display in React\npriceSnap.docs.forEach(function(price){products[productDoc.id].prices={priceId:price.id,priceData:price.data()};});case 5:case\"end\":return _context2.stop();}}},_callee2);}));return function(_x2){return _ref2.apply(this,arguments);};}());setProducts(products);});},[]);//   console.log(products);\n//   console.log(subscription);\nvar loadCheckout=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(priceId){var docRef;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:_context4.next=2;return db.collection(\"customers\").doc(user.uid).collection(\"checkout_sessions\").add({price:priceId,success_url:window.location.origin,cancel_url:window.location.origin});case 2:docRef=_context4.sent;docRef.onSnapshot(/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(snap){var _snap$data,error,sessionId,stripe;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_snap$data=snap.data(),error=_snap$data.error,sessionId=_snap$data.sessionId;if(error){// Show an error to your customer and\n// inspect your Cloud Function logs in the Firebase console.\nalert(\"An error occured: \".concat(error.message));}if(!sessionId){_context3.next=7;break;}_context3.next=5;return loadStripe(\"pk_test_51JppQuKkj70g0AsOjZFgkuWkeeyIlif0GJuX3FYtVz3XLTJ69vXnACnPrTgRKS9b82OREwMg2BA9NPhZZf5v3o2y00zIUizkFt\");case 5:stripe=_context3.sent;stripe.redirectToCheckout({sessionId:sessionId});case 7:case\"end\":return _context3.stop();}}},_callee3);}));return function(_x4){return _ref4.apply(this,arguments);};}());case 4:case\"end\":return _context4.stop();}}},_callee4);}));return function loadCheckout(_x3){return _ref3.apply(this,arguments);};}();return/*#__PURE__*/_jsxs(\"div\",{className:\"plansScreen\",children:[/*#__PURE__*/_jsx(\"br\",{}),subscription&&/*#__PURE__*/_jsxs(\"p\",{children:[\"Renewal date:\",\" \",new Date((subscription===null||subscription===void 0?void 0:subscription.current_period_end)*1000).toLocaleDateString()]}),Object.entries(products).map(function(_ref5){var _productData$name;var _ref6=_slicedToArray(_ref5,2),productId=_ref6[0],productData=_ref6[1];var isCurrentPackage=(_productData$name=productData.name)===null||_productData$name===void 0?void 0:_productData$name.toLowerCase().includes(subscription===null||subscription===void 0?void 0:subscription.role);return/*#__PURE__*/_jsxs(\"div\",{className:\"\".concat(isCurrentPackage&&\"plansScreen__plan--disabled\",\" plansScreen__plan\"),children:[/*#__PURE__*/_jsxs(\"div\",{className:\"plansScreen__info\",children:[/*#__PURE__*/_jsx(\"h5\",{children:productData.name}),/*#__PURE__*/_jsx(\"h6\",{children:productData.description})]}),/*#__PURE__*/_jsx(\"button\",{onClick:function onClick(){return!isCurrentPackage&&loadCheckout(productData.prices.priceId);},children:isCurrentPackage?\"Current Plan\":\"Subscribe\"})]},productId);})]});}export default PlansScreen;","map":{"version":3,"sources":["C:/Users/luren/Documents/GitHub/netflix-clone-diy/src/screens/PlanScreen.js"],"names":["React","useEffect","useState","useSelector","selectUser","db","loadStripe","PlansScreen","products","setProducts","user","subscription","setSubscription","collection","doc","uid","get","then","querySnapshot","forEach","role","data","current_period_end","seconds","current_period_start","where","productDoc","id","ref","priceSnap","docs","price","prices","priceId","priceData","loadCheckout","add","success_url","window","location","origin","cancel_url","docRef","onSnapshot","snap","error","sessionId","alert","message","stripe","redirectToCheckout","Date","toLocaleDateString","Object","entries","map","productId","productData","isCurrentPackage","name","toLowerCase","includes","description"],"mappings":"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","sourcesContent":["import React, { useEffect, useState } from \"react\";\r\nimport { useSelector } from \"react-redux\";\r\nimport { selectUser } from \"../features/userSlice\";\r\nimport db from \"../firebase\";\r\nimport \"./PlanScreen.css\";\r\n// stripe\r\nimport { loadStripe } from \"@stripe/stripe-js\";\r\n\r\nfunction PlansScreen() {\r\n  const [products, setProducts] = useState([]);\r\n  const user = useSelector(selectUser);\r\n  const [subscription, setSubscription] = useState(null);\r\n\r\n  useEffect(() => {\r\n    db.collection(\"customers\")\r\n      .doc(user.uid)\r\n      .collection(\"subscriptions\")\r\n      .get()\r\n      .then((querySnapshot) => {\r\n        querySnapshot.forEach(async (subscription) => {\r\n          setSubscription({\r\n            role: subscription.data().role,\r\n            current_period_end: subscription.data().current_period_end.seconds,\r\n            current_period_start: subscription.data().current_period_start\r\n              .seconds,\r\n          });\r\n        });\r\n      });\r\n  }, [user.uid]);\r\n\r\n\r\n  useEffect(() => {\r\n    db.collection(\"products\")\r\n      .where(\"active\", \"==\", true)\r\n      .get()\r\n      .then((querySnapshot) => {\r\n        const products = {};\r\n        querySnapshot.forEach(async (productDoc) => {\r\n          products[productDoc.id] = productDoc.data();\r\n          const priceSnap = await productDoc.ref.collection(\"prices\").get();\r\n          // so we take the prices from our database and forEach them onto\r\n          // our new products array to display in React\r\n          priceSnap.docs.forEach((price) => {\r\n            products[productDoc.id].prices = {\r\n              priceId: price.id,\r\n              priceData: price.data(),\r\n            };\r\n          });\r\n        });\r\n        setProducts(products);\r\n      });\r\n  }, []);\r\n\r\n//   console.log(products);\r\n//   console.log(subscription);\r\n \r\n  const loadCheckout = async (priceId) => {\r\n    const docRef = await db\r\n      .collection(\"customers\")\r\n      .doc(user.uid)\r\n      .collection(\"checkout_sessions\")\r\n      .add({\r\n        price: priceId,\r\n        success_url: window.location.origin,\r\n        cancel_url: window.location.origin,\r\n      });\r\n\r\n      docRef.onSnapshot(async (snap) => {\r\n        const { error, sessionId } = snap.data();\r\n  \r\n        if (error) {\r\n          // Show an error to your customer and\r\n          // inspect your Cloud Function logs in the Firebase console.\r\n          alert(`An error occured: ${error.message}`);\r\n        }\r\n  \r\n        if (sessionId) {\r\n          const stripe = await loadStripe(\r\n            \"pk_test_51JppQuKkj70g0AsOjZFgkuWkeeyIlif0GJuX3FYtVz3XLTJ69vXnACnPrTgRKS9b82OREwMg2BA9NPhZZf5v3o2y00zIUizkFt\"\r\n          );\r\n          stripe.redirectToCheckout({ sessionId });\r\n        }\r\n      });\r\n    };\r\n\r\n    return (\r\n        <div className=\"plansScreen\">\r\n          <br />\r\n          {subscription && (\r\n            <p>\r\n              Renewal date:{\" \"}\r\n              {new Date(\r\n                subscription?.current_period_end * 1000\r\n              ).toLocaleDateString()}\r\n            </p>\r\n          )}\r\n          {Object.entries(products).map(([productId, productData]) => {\r\n            const isCurrentPackage = productData.name\r\n              ?.toLowerCase()\r\n              .includes(subscription?.role);\r\n    \r\n            return (\r\n              <div\r\n                key={productId}\r\n                className={`${\r\n                  isCurrentPackage && \"plansScreen__plan--disabled\"\r\n                } plansScreen__plan`}\r\n              >\r\n                <div className=\"plansScreen__info\">\r\n                  <h5>{productData.name}</h5>\r\n                  <h6>{productData.description}</h6>\r\n                </div>\r\n    \r\n                <button\r\n                  onClick={() =>\r\n                    !isCurrentPackage && loadCheckout(productData.prices.priceId)\r\n                  }\r\n                >\r\n                  {isCurrentPackage ? \"Current Plan\" : \"Subscribe\"}\r\n                </button>\r\n              </div>\r\n            );\r\n          })}\r\n        </div>\r\n      );\r\n    }\r\n    \r\n    export default PlansScreen;"]},"metadata":{},"sourceType":"module"}